{% load i18n %}
{% load static %}

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<header class="middleeast-header px-3">
  <div class="container-fluid">
    <div class="row align-items-center">

      <!-- LEFT : MENU + LOGO -->
      <div class="col-6 col-md-auto d-flex align-items-center gap-2">
        <button id="menuBtn" class="btn d-lg-none">
          <i class="bi bi-list fs-4"></i>
        </button>

        <a href="/" class="text-center">
          <img src="{{ profile_setting.logo_dark.url }}" class="logo-light" style="height:50px;">
          <img src="{{ profile_setting.logo_light.url }}" class="logo-dark" style="height:50px;">
        </a>
      </div>

      <!-- CENTER : SEARCH (DESKTOP/TABLET) -->
      <div class="col d-none d-md-flex justify-content-center">
        <div class="search-box position-relative" style="max-width:700px;width:100%;">
          <i class="bi bi-search position-absolute"
            style="left:15px;top:50%;transform:translateY(-50%);"></i>

          <form action="{% url 'search' %}" method="get">
            <input type="text" id="searchBox" name="title"
              class="form-control ps-5 rounded-pill"
              placeholder="Search news, topics or categories..."
              autocomplete="off">
          </form>

          <div id="suggestionsBox"
            class="suggestions position-absolute w-100 card-bg-dark border rounded-3 shadow-sm d-none mt-1"></div>
        </div>
      </div>

      <!-- RIGHT : ICONS -->
      <div class="col-6 col-md-auto d-flex justify-content-end align-items-center gap-2">
        <!-- Language -->
        <div class="language-button-wrapper d-none d-md-inline-block">
          <i class="bi bi-translate fs-5"></i>
          <div id="google_translate_element"></div>
        </div>
           <!-- Search (mobile) -->
        <button class="btn d-md-none" data-bs-toggle="modal" data-bs-target="#ModalSearch">
          <i class="bi bi-search fs-5"></i>
        </button>
        <!-- Date -->
        <span class="d-none d-lg-block d-md-none align-items-center small">
          <i class="bi bi-calendar-date-fill me-1"></i>
          <span id="currentDate"></span>
        </span>

        <!-- Subscribe -->
        <button class="glossy-btn d-none d-md-inline-flex"
          data-bs-toggle="modal" data-bs-target="#ModalSubscribe">
           <i class="bi bi-bell-fill me-1"></i> Subscribe
        </button>
        <a class="d-md-none d-md-inline-flex"
          data-bs-toggle="modal" data-bs-target="#ModalSubscribe">
           <i class="bi bi-bell-fill fs-5 me-1"></i>
        </a>
      
        <!-- Dark -->
        <!-- <button id="darkToggle" class="middleeast-toggle d-none d-md-inline-flex">
          <i class="bi bi-moon"></i> Dark
        </button> -->
      </div>

    </div>

  <div class="container">
    <!-- NAV : DESKTOP ONLY -->
    <div class="row d-md-none d-lg-block">
      
      <div class="col">
        
        <div class="middleeast-topnav">
          {% for link in Blogcat %}
          <div class="middleeast-dropdown">
            <a href="#" class="middleeast-dropdown-toggle">
              {% trans link.cat_name %}
            </a>
            {% if link.sub_category_set.all %}
            <div class="middleeast-dropdown-menu">
              {% for sublink in link.sub_category_set.all %}
              <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}">
                {% trans sublink.subcat_name %}
              </a>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
</div>

  </div>
</header>

  <div class="social-sidebar-right">
        <div class="social-icons">
          
          {% if profile_setting.youtube %}
          <a href="{{ profile_setting.youtube }}" target="_blank" class="youtube">
            <i class="bi bi-youtube"></i>
          </a>
          {% endif %}

          {% if profile_setting.instagram %}
          <a href="{{ profile_setting.instagram }}" target="_blank" class="instagram">
            <i class="bi bi-instagram"></i>
          </a>
          {% endif %}

          {% if profile_setting.facbook %}
          <a href="{{ profile_setting.facbook }}" target="_blank" class="facebook">
            <i class="bi bi-facebook"></i>
          </a>
          {% endif %}

          {% if profile_setting.twitter %}
          <a href="{{ profile_setting.twitter }}" target="_blank" class="twitter">
            <i class="bi bi-twitter-x"></i>
          </a>
          {% endif %}

          {% if profile_setting.linkedin %}
          <a href="{{ profile_setting.linkedin }}" target="_blank" class="linkedin">
            <i class="bi bi-linkedin"></i>
          </a>
          {% endif %}

        </div>
      </div>
 {% include 'subscribe_model.html' %}
<!-- SIDEBAR -->
<div class="middleeast-sidebar" id="sidebar">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
     <a href="/" class="d-inline-block">
        <img src="{{ profile_setting.logo_dark.url }}" alt="Dark Logo" class="logo-light" style="max-height:36px;">
        <img src="{{ profile_setting.logo_light.url }}" alt="Light Logo" class="logo-dark" style="max-height:36px;">
      </a>
    </div>
    <button class="btn btn-light btn-sm" id="closeSidebar"><i class="bi bi-x-lg"></i></button>
  </div>

    <!-- âœ… middleeast SIDEBAR MENU -->
    <ul class="nav flex-column" id="middleeastSidebarMenu">

      {% for link in Blogcat %}
      <li class="border-bottom mb-1 pb-1">
        <a href="#"
          class="nav-link dropdown-toggle"
          data-bs-toggle="collapse"
          data-bs-target="#menu{{ forloop.counter }}"
          aria-expanded="false">
          {{ link.cat_name }}
        </a>

        {% if link.sub_category_set.all %}
        <ul class="submenu collapse" id="menu{{ forloop.counter }}" data-bs-parent="#middleeastSidebarMenu">
          {% for sublink in link.sub_category_set.all|dictsort:"subcat_status" %}
            {% if sublink.subcat_status == 'active' %}
            <li>
              <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}" class="nav-link">
                {{ sublink.subcat_name }}
              </a>
            </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
      </li>
      {% endfor %}

    </ul>


</div>
<!-- ðŸ” Search Modal -->
<div class="modal fade" id="ModalSearch" tabindex="-1" aria-labelledby="ModalSearchLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Header -->
      <div class="modal-header border-0 pb-0 px-4 pt-4">
        <h5 class="modal-title fw-semibold " id="ModalSearchLabel">Search</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          style="width: 40px; height: 40px; background-color: transparent; border: none;">
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body px-4 pb-4 pt-3">

        <form action="{% url 'search' %}" method="get" class="mx-auto" style="max-width: 600px;">
          <div class="input-group input-group-lg border rounded-pill shadow-sm overflow-hidden">
            <span class="input-group-text card-bg-dark border-0 ps-4">
              <i class="bi bi-search text-secondary"></i>
            </span>
            <input type="text" name="title" class="form-control border-0 shadow-none"
              placeholder="Search for posts, topics or categories..." required>
          </div>

          <button type="submit"
            class="btn w-100 mt-4 py-2 rounded-pill fw-semibold text-white"
            style="background-color: #cc1227  ; border: none; font-size: 16px;">
            Search
          </button>
        </form>

      </div>
    </div>
  </div>
</div>

<div class="middleeast-overlay" id="overlay"></div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Load Google Translate API -->

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
    window.addEventListener("scroll", function () {
        var stickyNav = document.getElementById("stickyNav");
        if (window.pageYOffset > 100) {
            stickyNav.style.display = "block";
        } else {
            stickyNav.style.display = "none";
        }
    });

    const getFormattedDate = () => {
        const options = { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' };
        const today = new Date();
        return today.toLocaleDateString('en-US', options);
    };
    document.getElementById('currentDate').innerText = getFormattedDate();
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {

  const menuBtn = document.getElementById("menuBtn");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const closeSidebar = document.getElementById("closeSidebar");
  const darkToggle = document.getElementById("darkToggle");

  // Sidebar toggle
  if (menuBtn) {
    menuBtn.addEventListener("click", () => {
      sidebar.classList.add("active");
      overlay.classList.add("active");
    });
  }

  if (closeSidebar) {
    closeSidebar.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    });
  }

  if (overlay) {
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    });
  }

  // Dark mode toggle safe
  if (darkToggle) {
    darkToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
    });
  }

  // ================= DESKTOP DROPDOWN =================
  document.querySelectorAll('.middleeast-dropdown-toggle').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const parent = btn.parentElement;

      // close others
      document.querySelectorAll('.middleeast-dropdown.show')
        .forEach(drop => {
          if (drop !== parent) drop.classList.remove('show');
        });

      parent.classList.toggle('show');
    });
  });

  // close if clicked outside
  document.addEventListener('click', () => {
    document.querySelectorAll('.middleeast-dropdown.show')
      .forEach(drop => drop.classList.remove('show'));
  });

});
</script>

<script>
  function applyCustomTranslateStyles() {
  const combo = document.querySelector('.goog-te-combo');
  if (combo) {
    combo.style.backgroundColor = 'black';
    combo.style.color = 'white';
    combo.style.border = '1px solid #444';
    combo.style.padding = '16px';
    combo.style.borderRadius = '6px';
  }
}

// Wait for the widget to load
setTimeout(applyCustomTranslateStyles, 1000);
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,hi,pa',
      layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
      autoDisplay: false
    }, 'google_translate_element');
  }

  function hideTranslateBanner() {
    const elements = document.querySelectorAll(".VIpgJd-ZVi9od-ORHb-OEVmcd.skiptranslate");
    elements.forEach(el => {
      el.style.display = "none";
    });
  }

  // Run once on load
  hideTranslateBanner();

  // Watch for future changes (Google injects banner after load)
  const observer = new MutationObserver(hideTranslateBanner);
  observer.observe(document.body, { childList: true, subtree: true });
</script>

<script>
  const searchBox = document.getElementById('searchBox');
  const suggestionsBox = document.getElementById('suggestionsBox');

  // Load from localStorage
  function getRecentSearches() {
    return JSON.parse(localStorage.getItem('recentSearches') || '[]');
  }

  function saveRecentSearch(query) {
    if (!query) return;
    let recents = getRecentSearches().filter(item => item.toLowerCase() !== query.toLowerCase());
    recents.unshift(query);
    if (recents.length > 5) recents = recents.slice(0, 5); // keep only 5 latest
    localStorage.setItem('recentSearches', JSON.stringify(recents));
  }

  function showRecentSearches() {
    const recents = getRecentSearches();
    if (recents.length > 0) {
      suggestionsBox.innerHTML = `
        <div class="recent-header">Recent Searches</div>
        ${recents.map(item => `<div class="suggestion-item" data-title="${item}">${item}
        </div>`).join('')}
      `;
      suggestionsBox.classList.remove('d-none');
    }
  }

  // When focused, show recent searches
  searchBox.addEventListener('focus', showRecentSearches);

  // Live suggestions (AJAX)
  searchBox.addEventListener('input', () => {
    const query = searchBox.value.trim();
    if (query.length < 2) {
      showRecentSearches();
      return;
    }

    fetch(`/search-suggestions/?q=${encodeURIComponent(query)}`)
      .then(response => response.json())
      .then(data => {
        const suggestions = data.suggestions || [];
        if (suggestions.length > 0) {
          suggestionsBox.innerHTML = suggestions
            .map(item => `<div class="suggestion-item" data-title="${item.title}">
              <i class="bi bi-search text-muted me-2"></i>${item.title}
            </div>`)
            .join('');
          suggestionsBox.classList.remove('d-none');
        } else {
          suggestionsBox.classList.add('d-none');
        }
      });
  });

  // Hide when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-box')) suggestionsBox.classList.add('d-none');
  });

  // Click suggestion or recent â†’ go to search page
  suggestionsBox.addEventListener('click', (e) => {
    const item = e.target.closest('.suggestion-item');
    if (item) {
      const title = item.getAttribute('data-title');
      saveRecentSearch(title);
      window.location.href = `{% url 'search' %}?title=${encodeURIComponent(title)}`;
    }
  });

  // Press Enter â†’ go to search + save
  searchBox.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const query = searchBox.value.trim();
      if (query) {
        saveRecentSearch(query);
        window.location.href = `{% url 'search' %}?title=${encodeURIComponent(query)}`;
      }
    }
  });
</script>